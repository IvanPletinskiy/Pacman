package dawist_o.pacman.pacmanData;


import dawist_o.pacman.engine.Game;
import dawist_o.pacman.engine.GameObject;
import dawist_o.pacman.gui.*;
import dawist_o.pacman.gui.Menu;
import dawist_o.pacman.gui.GhostCaughtPoint;

import java.awt.*;
import java.awt.geom.Point2D;

public class PacmanGame extends Game {
    //1-стена
    //0-пусто
    //2-маленькая едп
    //3-большая еда
    public int[][] maze = {
            {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 3, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 3, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 1, 1, 2, 2, 2, 2, 1, 1, 2, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
            {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
            {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 3, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 2, 0, 0, 2, 2, 2, 2, 2, 2, 2, 1, 1, 2, 2, 3, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 1, 1, 2, 2, 2, 2, 1, 1, 2, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1},
            {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
    };

    //игровые состояние
    public enum State {
        INITIALIZING,
        PREVIEW,
        MENU,
        READY,
        READY_NEXT_LIFE,
        PLAYING,
        PACMAN_DIED,
        GHOST_CAUGHT,
        LEVEL_CLEARED,
        GAME_OVER
    }

    public State state = State.INITIALIZING;
    public int lives = 3;
    public int score; //текущий счет
    public int high_score; //максимальный счет
    public int totalFoodCount;
    public int currentFoodCount;


    public Ghost caughtGhost;
    public int currentGhostCaughtScore = 0;
    public final int[] caughtGhostScores = {200, 400, 600, 800};

    public PacmanGame() {
        //размеры экрана
        screenSize = new Dimension(224, 288);
        screenScale = new Point2D.Double(2, 2);
    }

    public State getState() {
        return state;
    }

    public void setState(State state) {
        //устанавливаем новое состояние игры
        if (this.state != state) {
            this.state = state;
            broadcastMessage("stateChanged");
        }
    }

    public void addScore(int point) {
        //добавить очки
        score += point;
        if (score > high_score) {
            high_score = score;
        }
    }

    public String getScore() {
        //полчение текущего счета в игре
        String scoreStr = "0000000" + score;
        scoreStr = scoreStr.substring(scoreStr.length() - 7);
        return scoreStr;
    }

    public String getHighScore() {
        //получение максимального количество очков полученных за игру
        String high_score_Str = "0000000" + high_score;
        high_score_Str = high_score_Str.substring(high_score_Str.length() - 7);
        return high_score_Str;
    }

    @Override
    public void init() {
        addAllObjects();
        initAllObjects();
    }

    private void addAllObjects() {
        //добавление всех элементов игры
        Pacman pacman = new Pacman(this);
        gameObjects.add(new Initializer(this));
        gameObjects.add(new Preview(this));
        gameObjects.add(new Menu(this));
        gameObjects.add(new Background(this));
        totalFoodCount = 0;
        addFood();//добавляем еду
        for (int ghostIndex = 0; ghostIndex < 4; ghostIndex++)//добавляем приведений
            gameObjects.add(new Ghost(this, pacman, ghostIndex));
        gameObjects.add(pacman);
        gameObjects.add(new GhostCaughtPoint(this, pacman));
        gameObjects.add(new Ready(this));
        gameObjects.add(new GameOver(this));
        gameObjects.add(new HeadUpDisplay(this));
    }

    private void addFood() {
        for (int row = 0; row < 31; row++) {
            for (int col = 0; col < 36; col++) {
                switch (maze[row][col]) {
                    case 1 -> maze[row][col] = -1; // конвертируем стену(1) в -1 для более легкого нахождения расстояния
                    case 2 -> {
                        //добавляем обычную точку
                        maze[row][col] = 0;
                        gameObjects.add(new Food(this, col, row));
                        totalFoodCount++;
                    }
                    case 3 -> {
                        //добавляем большую точку
                        maze[row][col] = 0;
                        gameObjects.add(new PowerFood(this, col, row));
                        totalFoodCount++;
                    }
                }
            }
        }
    }

    private void initAllObjects() {//инициализируем все объекты
        for (GameObject<?> actor : gameObjects) {
            actor.init();
        }
    }

    public void restoreCurrentFoodCount() {
        currentFoodCount = totalFoodCount;
    }

    public boolean isLevelCleared() {
        return currentFoodCount == 0;
    }

    public void start() {
        //начало игры
        setState(State.READY);
    }

    public void nextLife() {
        //следующаю жизнь
        lives--;
        if (lives == 0)
            setState(State.GAME_OVER);
        else
            setState(State.READY_NEXT_LIFE);
    }

    public void levelCleared() {
        setState(State.LEVEL_CLEARED);
    }

    public void nextLevel() {
        setState(State.READY);
    }

    public void returnToTitle() {
        //возврат в меню
        lives = 3;
        score = 0;
        setState(State.MENU);
    }

    public void ghostCaught(Ghost ghost) {
        //если пакман съел привидение
        caughtGhost = ghost;
        setState(State.GHOST_CAUGHT);
    }

    public void startGhostFearMode() {
        //активируем режим страха у привидения
        currentGhostCaughtScore = 0;
        broadcastMessage("startGhostFearMode");
    }
}
